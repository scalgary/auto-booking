name: Test URLs avec Log

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  test-urls:
    runs-on: ubuntu-latest
    
    env:
      YOUR_SECRET_EMAIL: ${{ secrets.YOUR_SECRET_EMAIL }}
      YOUR_SECRET_PASSWORD: ${{ secrets.YOUR_SECRET_PASSWORD }}
      YOUR_SECRET_LOGON_URL: ${{ secrets.YOUR_SECRET_LOGON_URL }}
      YOUR_SECRET_PLANNING_URL: ${{ secrets.YOUR_SECRET_PLANNING_URL }}
      YOUR_SECRET_LOGIN_URL: ${{ secrets.YOUR_SECRET_LOGIN_URL }}
      YOUR_SECRET_My_NAME: ${{ secrets.YOUR_SECRET_My_NAME }}
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'
      
      - name: Run Python script
        run: python3 test_secret.py
      
      - name: Check if log file exists
        run: |
          if [ -f "execution_log.txt" ]; then
            echo "✅ Fichier log trouvé"
            ls -la execution_log.txt
          else
            echo "❌ Fichier log non trouvé"
          fi
      
      - name: Display log content in GitHub logs
        run: |
          echo "=== 📋 CONTENU DU FICHIER EXECUTION_LOG.TXT ==="
          cat execution_log.txt
          echo "=== 📋 FIN DU LOG ==="
      
      - name: Upload log file as artifact
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: execution-log-${{ github.run_number }}
          path: execution_log.txt
          retention-days: 30
      
      - name: Add log summary to job summary
        if: always()
        run: |
          echo "## 📋 Résumé du Log d'Exécution" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          cat execution_log.txt >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "📁 Le fichier complet est disponible dans les artifacts." >> $GITHUB_STEP_SUMMARY