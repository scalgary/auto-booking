name: 'Create Success Tag'
description: 'CrÃ©e et push un tag de succÃ¨s avec prÃ©fixe configurable'

inputs:
  target_date:
    description: 'Date cible (DD-Mth-YY)'
    required: true
  workspace_path:
    description: 'Chemin du workspace Git'
    required: true
  github_token:
    description: 'GitHub token pour push'
    required: true
  github_repository:
    description: 'GitHub repository (owner/repo)'
    required: true
  tag_prefix:
    description: 'PrÃ©fixe pour les tags (ex: "my", "his")'
    required: false
    default: 'bot'

outputs:
  tag_created:
    description: 'true si le tag a Ã©tÃ© crÃ©Ã©, false sinon'
    value: ${{ steps.create.outputs.tag_created }}
  tag_name:
    description: 'Nom du tag crÃ©Ã©'
    value: ${{ steps.create.outputs.tag_name }}

runs:
  using: 'composite'
  steps:
    - name: Create and push success tag
      id: create
      shell: bash
      run: |
        echo "======================================"
        echo "ðŸ·ï¸  Creating success tag"
        echo "======================================"
        
        # Configuration Git
        echo "ðŸ”§ Configuring Git..."
        git config --global --add safe.directory ${{ inputs.workspace_path }}
        git config user.name "bot"
        git config user.email "bot@github.com"
        
        # Configurer l'authentification avec le token
        echo "ðŸ” Setting up authentication..."
        git remote set-url origin https://x-access-token:${{ inputs.github_token }}@github.com/${{ inputs.github_repository }}.git
        
        # PrÃ©parer le tag
        target_date="${{ inputs.target_date }}"
        prefix="${{ inputs.tag_prefix }}"
        tag="${prefix}_bot_success_${target_date}"
        
        echo "ðŸ·ï¸  Tag prefix: $prefix"
        echo "ðŸ“ Tag to create: $tag"
        
        # Pull les derniers changements
        echo "ðŸ”„ Pulling latest changes..."
        git pull
        
        # CrÃ©er le commit et le tag
        echo "âœ¨ Creating tag..."
        git commit --allow-empty -m "âœ… $tag"
        git tag "$tag"
        
        # Push vers remote
        echo "ðŸ“¤ Pushing tag to remote..."
        git push origin HEAD "$tag"
        
        echo "âœ… Tag pushed successfully!"
        
        # Exporter les outputs
        echo "tag_created=true" >> $GITHUB_OUTPUT
        echo "tag_name=$tag" >> $GITHUB_OUTPUT
        
        echo "======================================"